# Скрипты автоматического обновления FSA-AstraInstall
**Версия: V2.2.58 (2025.10.15)**

## Описание

Система автоматического обновления состоит из двух скриптов:

- **`astra_update.py`** (macOS): копирует файлы проекта в сетевую папку SMB
- **`astra_update.sh`** (Linux): копирует файлы из сетевой папки в локальную папку и запускает установку

## Использование

### На macOS
```bash
python3 astra_update.py
```

### На Linux
```bash
./astra_update.sh
```

## Что делает скрипт

### На macOS:
1. **Проверяет папку проекта** `/Volumes/FSA-PRJ/Project/FSA-AstraInstall`
2. **Подключается к SMB** `//10.10.55.77/Install`
3. **Создает папку Astra** в сети `/Volumes/SMB/10.10.55.77/Install/ISO/Linux/Astra`
4. **Копирует файлы:**
   - `astra_automation.py`
   - `astra_install.sh`
   - `astra_update.sh`
5. **Устанавливает права** на выполнение
6. **Показывает инструкции** для следующего шага

### На Linux:
1. **Проверяет доступность сервера** (настраивается в скрипте)
2. **Создает файл учетных данных** `~/.smbcredentials` (при первом запуске)
3. **Подключается к SMB** ресурсу с настроенным пользователем
4. **Копирует файлы** из сети в текущую папку (где находится скрипт)
5. **Очищает старые логи** (папка Log и лог файлы)
6. **Устанавливает права** на выполнение
7. **Запускает установку** `./astra_install.sh`

## Настройки

### Пути для macOS:
- Исходная папка: `/Volumes/Project/FSA-AstraInstall` (пример)
- Сетевая папка: `/Volumes/NetworkShare/Path/To/Files` (пример)

### Пути для Linux:
- SMB ресурс: `//server.example.com/share` (пример)
- Путь к файлам: `path/to/files/` (пример)
- Локальная папка: текущая папка (где находится скрипт)

## Аутентификация SMB

### Linux:
При первом запуске скрипт запросит пароль для настроенного пользователя и сохранит его в файл `~/.smbcredentials` с правами `600` (только для владельца).

Последующие запуски будут использовать сохраненные учетные данные без запроса пароля.

## Логирование

Все действия логируются с временными метками:
```
[14:23:38] FSA-AstraInstall - Обновление
[14:23:38] Операционная система: macos
[14:23:39] ✓ Папка с исходными файлами найдена
[14:23:40] ✓ Скопирован в сеть: astra_automation.py
```

## Требования

- Bash shell
- Доступ к сети и серверу SMB
- На Linux: права root для подключения SMB
- Утилиты: `cp`, `mkdir`, `rm`, `chmod`, `mount`

## Рабочий процесс

1. **Разработка на macOS**: редактируешь файлы в проекте
2. **Запуск на macOS**: `python3 astra_update.py` - копирует в сеть и показывает уведомление
3. **Запуск на Linux**: `./astra_update.sh` - копирует из сети и запускает установку

## Преимущества

- ✅ Отдельные скрипты для каждой ОС
- ✅ Автоматическое сохранение учетных данных
- ✅ Копирование файлов в текущую папку (самообновление)
- ✅ Очистка старых логов
- ✅ Автоматический запуск установки на Linux
- ✅ GUI уведомления на macOS
- ✅ Подробное логирование всех операций